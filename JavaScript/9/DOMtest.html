<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DOM + 闭包</title>
</head>

<body>
  <ul>
    <li>a</li>
    <li>a</li>
    <li>a</li>
    <li>a</li>
  </ul>

  <script>
    // 使用原生js , 给每个li元素绑定一个click事件 , 输出他们的顺序
    function test() {
      var liCollection = document.getElementsByTagName('li');
      for (var i = 0; i < liCollection.length; i++) {
        liCollection[i].onclick = function () {
          console.log(i); // 4 4 4 4
        }
      }
    }
    test();
    // 问题分析: 每一个函数在诞生后都被保存到了外部的DOM元素上从而形成了闭包 (他们的作用域链上的变量i都是同一个)

    // 方法修正
    function test2() {
      var liCollection = document.getElementsByTagName('li');
      for (var i = 0; i < liCollection.length; i++) {
        (function (j) {
          liCollection[j].onclick = function () {
            console.log(j); // 0 1 2 3
          }
        }(i));
      }
    }
    test2();
  </script>
</body>

</html>